priority:5
unique:T
~
roomNumber:5
~
# Gurantee a map that makes sense for the arrivals
mapID:Level5-1
~
:play:BeforeBattle2
:if:firstTime:{
:call:PreFirst
}
:else:{
:call:PreRepeat
}

~ Post-battle
Frogman: Everyone, this way!\a Let's get out of here!
:loadMap:Part2RestArea
:loadUnits:Part2RestArea
:play:Anticipation
:if:hasCharacter:Xeplogi{
Xeplogi: Hold!\a Where do you come from, monster friends?\a Are you Tori minions sent to serve me?
Frogman: What? No, we're fellow Magmaborn.
Xeplogi: What?
Frogman: When you died, you had a crystal with you - an emblem,\a you might say, correct?
Xeplogi: Are you talking about the holy Tori relic?
Frogman: Yes, whatever. Anyway, this allowed you to be reborn as-
Xeplogi: And serve the glorious Tori in his holy crusade against\a Memerian!
Frogman: I- you know what, never mind.\a Yes, we're Tori followers.\a Happy now?
Xeplogi: Indeed! Let us march on!
Frogman: *sigh*
:if:hasCharacter:Firbell{
Firbell: Frogman.
Frogman: Yes?
Firbell: Are you sure that siding with this lunatic is a good idea?
Frogman: He's a Magmaborn, like us.\a We should all help each other,\a regardless of our conditions.
Firbell: ...Very well. I will trust you on this.\a But these humans... Why are we fighting them?
Frogman: They attacked us.\a Do we need another reason?
Firbell: Yet they are sentinet beings, like us.\a Should we not join forces, as you yourself said?
Frogman: Xeplogi didn't attack us.
Firbell: We do appear as monsters.
What if they were sent here by Irenhold?\a We must inform them I am here.
Frogman: So this is what it's all about, eh?
Firbell: It would be dishonorable to fight without a formal-
Frogman: No, I get it. We'll try talking to them then.\a But I doubt they'll listen.
Firbell: Very well. Thank you, Frogman.
:setFlag:FirbellGuards1
# TBA: Add a similar conversation outside FirstTime, and a follow-up one
}
}
:else:{
Frogman||L: Xeplogi didn't make it, huh?
:if:hasCharacter:Kresla{
Kresla: No. He was a weird one. I wonder what's his story.\a Who's this Tori?\a How is it possible that he has never seen a\a Magmaborn before? Where did he come from? When?\a So many questions!
Frogman: Yes, well, I'm sure we'll meet him again one day.
}
:else:{
:if:hasCharacter:Xirveros{
Xirveros: Ooze dead? No! Me like ooze.\a Me write ooze song!
Frogman: No, please don't-
Xirveros: An ooze was here    \w@
Everyone could hear \w@
He liked to scream  \w@
Smelled like cream  \w@
Over and over       \w@
Over and over       \w@
Frogman: ...Wow.
}
:else:{
Oh well.
}
}
}

# === Functions ====

~ PreFirst
:loadUnits::player
Frogman: Huh?\a Structures?\a I've never seen any here before.
# TODO: Separate properly
:if:hasCharacter:Firbell{
Firbell: Neither have I.\a We must be rather deep indeed.\a Who could have made them?
}
:if:hasCharacter:Kresla{
Kresla: Structures? Here?! This is incredible!\a Who made them? When? How?\a I've never even seen any usable materials!\a We must explo-
}
:addUnit:Xeplogi
:loadUnits::player
Xeplogi|???|R: Hold. Who goes there?
:if:charactersAlive:>0:{
Frogman: Oh, another Magmaborn?
Uh, I'm Frogman, and these are my fellow Magmaborn.
:if:hasCharacter:Firbell{
Firbell||L: I am Firbell, the princess of Irenhold. Who are you?
Xeplogi|???: Princess, are you? And of a made-up kingdom, no less.\a How amusing. Oh ho ho!
Firbell: Excuse me? Made up kingdom?!\a Are you from the same backwater village as Kresla?!
Xeplogi|???: Backwater village? I'm no peasant, girl.
Xeplogi||R: I am the Duke of Jess, Xeplogi the Third.\a Pleased to make your acquaintance.
Firbell: Claiming to be a duke when you are not a noble?
And of a made up place you are not even from?\a Pathetic.\a Froman, let us leave this poor fool alone.
Xeplogi: H-how dare you insult me like that!\a Jess is the most important duchy of Enkress,\a you-
:setFlag:FirbellXeplogi1
:call:GuardsArriveFirst
:return:
}
:else:{
:if:hasCharacter:Kresla{
Kresla||L: Wow, I've never seen you before! Who are you?
}
:if:hasCharacter:Xirveros{
Xirveros||L: Hello, green friend! We can now have green party!
Frogman||L: ...Yeah, it's best to ignore him.\a Who are you?
}
}
}
Xeplogi|???|R: My, what a lovely entourage you have there!
:else:{
Frogman: Oh, another Magmaborn? Uh, I'm Frogman.\a Who are you?
}
Xeplogi||R: I am the Duke of Jess, Xeplogi the Third.\a Pleased to make your acquaintance.
:if:hasCharacter:Kresla{
# TODO: Reduce length, it's way too long
Kresla: Xeplogi of Jess? Of Xeplogi and the Witch fame?!
Xeplogi: I'm afraid I never caught you name, er...?
Kresla: Right, sorry. I'm Kresla, a renowned scholar.\a And you're Vengeful Xeplogi, right?
Xeplogi: Only my enemies call me that. Please, call me Duke Xeplogi.
Kresla: I knew it! It IS you! So this is where you disappeared to?!\a Wait, does that mean that Memerian is here too?!
Xeplogi: Unfortunately, yes.
I assume you'll run into her eventually.
Kresla: I can't believe it! A fairy tale hero,\a standing right here besides me!\a This is almost as exciting as the discovery of magic!
Xeplogi: I'm a hero, then? Oh ho ho! I like the sound of that.
Frogman: I'm afraid I didn't get any of this.
Kresla: What, you don't know Xeplogi and the Witch?\a It's a popular children's story!
Xeplogi: W-wait, children?!
Kresla: In short, there was this duke named Xeplogi,\a who wanted to be immortal.\a He heard about a legendary blacksmith named Memerian,\a who was said to have discovered immortality.\a Xeplogi tried to buy her secret, but she refused.\a They fought, and both disappeared.
Frogman: That's... a pretty lame story.
Xeplogi: It's a very rough outline. What really happened was-
:setFlag:KreslaXeplogi1
}
:else:{
Frogman: A duke? I... see.
Xeplogi: Indeed I am! Have you ever heard of me, perchance?
Frogman: No, never.
Xeplogi: You must have lived in quite the backwater village then.\a Oh ho ho!
Frogman: ...
Xeplogi: Who were you before arriving here, my dear Fro-
}
:call:GuardsArriveFirst

~ GuardsArriveFirst
:addGenericCharacter:Guard1:young
:addGenericCharacter:Guard2:old
:play:GuardTheme
???: Hey! Is someone there?
Frogman|: Huh? Another Magmaborn?
Xeplogi||R: I was in the middle-
:loadUnits:
Guard2: No, look! Those are Magmaborn!
Frogman: Humans?!
:if:hasCharacter:Firbell{
Firbell: Humans?!
}
:if:hasCharacter:Kresla{
Kresla: Humans?!
}
:if:hasCharacter:Xirveros{
Xirveros: No... Again... Frog, back...
}
Xeplogi||R: Ugh. The detestable Guards are back.
Frogman: You know these humans?!
Xeplogi: Yes. They are-
Guard1: Aha! This must be my lucky day!\a Fiends! Your reign of terror has come to an end!\a For I, [Name], shall destroy you all!
Xeplogi: All they ever really do is-
Guard2: How many of them are there?!\a Never mind, kill every last one of them!
Xeplogi: They hate-
Guard2: CHAAAAAAAAARGE!
Xeplogi: Oh, shut up! I'm trying to explain-
Frogman: Xeplogi, let's leave the explaining to after this battle.
Xeplogi: You- Ugh, fine.\a Let us do just that, then.
:setFlag:MetXeplogi

~ PreRepeat
:loadUnits::player
Frogman: Structures again? That must mean...
:addUnit:Xeplogi
:loadUnits::player
Xeplogi: Frogman, my dear friend! You're back.
Frogman: Yes.
Xeplogi: It's so good to see you again.\a I wanted to convey my dissapointment in you.
Frogman: Likew- Wait, what?
Xeplogi: You died last time we fought together.\a That was a very bad idea.
Frogman: It... wasn't my idea.
Xeplogi: Really? Then we should punish whoever suggested it.\a It was absolutley terrible.
Frogman: Xeplogi, nobody suggested it! I was killed!
Xeplogi: We have a murderer in our ranks?! Who could it be?
:setSpeaker:Xeplogi||L
:addGenericCharacter:Guard1:young
:addGenericCharacter:Guard2:old
:play:GuardTheme
:loadUnits:
Guard1: ...Pfft! Ha ha ha!
Guard2: Silence!\a Ugh, look! You've ruined our ambush!
Xeplogi||L: Oh my! Look at all these monsters and humans!
Frogman: Yes, they're what killed us last time.
We should stop talking if we want to stay alive this time.
Xeplogi: Now, that's a good idea.\a Keep them coming, boy.
Frogman: That- Ugh. Let's just get started.
