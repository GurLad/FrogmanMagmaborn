priority:4
unique:T
~ Requirements
levelNumber:5
hasCharacter:Firbell
!hasFlag:FirbellXeplogi1
charactersAlive:>1
~ Demands
# Guarantee a map that makes sense for the arrivals
hasTag:PlayersSpawnFirst
~ Before battle
:if:!hasFlag:FirbellXeplogi1{
:setFlag:FirbellXeplogi1
:if:!hasFlag:MetXeplogi{
# PreActualFirst
:play:BeforeBattle2
:loadUnits::player
Frogman: Huh?\a Structures?\a I've never seen any here before.
Firbell: Neither have I.\a We must be rather deep indeed.\a Who could have made them?
:addUnit:Xeplogi
:loadUnits::player
Xeplogi|???|R: Hold. Who goes there?
Frogman: Oh, another Magmaborn?
Uh, I'm Frogman, and these are my fellow Magmaborn.
Firbell||L: I am Firbell, the princess of Irenhold. Who are you?
Xeplogi|???: Princess, are you? And of a made-up kingdom, no less.\a How amusing. Oh ho ho!
Firbell: Excuse me? Made up kingdom?!\a Are you from the same backwater village as Kresla?!
Xeplogi|???: Backwater village? I'm no peasant, girl.
:setSpeaker:Xeplogi||R
I am the Duke of Jess, Xeplogi the Third.\a Pleased to make your acquaintance.
Firbell: Claiming to be a duke when you are not a noble?
And of a made up place you are not even from?\a Pathetic.\a Frogman, let us leave this poor fool alone.
Xeplogi: H-how dare you insult me like that!\a Jess is the most important duchy of Enkress,\a you-
:if:hasCharacter:Xirveros{
:setFlag:XirverosXeplogi1
}
:call:GuardsArriveFirst
:finishConversation:
}
:else:{
:if:furthestLevel:<4{
# PreCharacterFirstNoWin
:play:BeforeBattle2
:loadUnits::player
Frogman: Structures again? That must mean...
:addUnit:Xeplogi
:loadUnits::player
Xeplogi: Frogman, my dear friend! You're back.\a And you brought company, I see!\a Who might you be?
Firbell||L: I am Firbell, the princess of Irenhold. Who are you?
Xeplogi: Princess, are you? And of a made-up kingdom, no less.\a How amusing. Oh ho ho!
Firbell: Excuse me? Made up kingdom?!\a Are you from the same backwater village as Kresla?!
Xeplogi: Backwater village? I'm no peasant, girl.
:setSpeaker:Xeplogi||R
I am the Duke of Jess, Xeplogi the Third.\a Pleased to make your acquaintance.
Firbell: Claiming to be a duke when you are not a noble?
And of a made up place you are not even from?\a Pathetic.\a Frogman, let us leave this poor fool alone.
Xeplogi: H-how dare you insult me like that!\a Jess is the most important duchy of Enkress,\a you-
:setSpeaker:Xeplogi||L
:addGenericCharacter:Guard1:
:addGenericCharacter:Guard2:
:play:GuardTheme
:loadUnits:
Guard1: So I came up to him, right, and said:\a you know these statues you like so much?\a Well I- 
Guard2: Silence!\a Ugh, look! You've ruined our ambush!
Xeplogi||L: Oh my! Look at all these monsters and humans!
Firbell||L: Humans?!
Guard1: Oops.
Frogman: Ugh, the Guards again... Let's get out of here.
Firbell||L: You know these humans?!
Frogman||L: Yes. They're-
Guard2: Don't let them get away! Protect the Fortress!
Frogman: All they ever really do is-
Guard1: Hey! I wasn't done with my story!
Frogman: ...I'll explain later. Let's go!
:if:hasCharacter:Xirveros{
:setFlag:XirverosXeplogi1
}
:finishConversation:
}
:else:{
# PreCharacterFirstPostWin
# Same as no win for now
:play:BeforeBattle2
:loadUnits::player
Frogman: Structures again? That must mean...
:addUnit:Xeplogi
:loadUnits::player
Xeplogi: Frogman, my dear friend! You're back.\a And you brought company, I see!\a Who might you be?
Firbell||L: I am Firbell, the princess of Irenhold. Who are you?
Xeplogi: Princess, are you? And of a made-up kingdom, no less.\a How amusing. Oh ho ho!
Firbell: Excuse me? Made up kingdom?!\a Are you from the same backwater village as Kresla?!
Xeplogi: Backwater village? I'm no peasant, girl.
:setSpeaker:Xeplogi||R
I am the Duke of Jess, Xeplogi the Third.\a Pleased to make your acquaintance.
Firbell: Claiming to be a duke when you are not a noble?
And of a made up place you are not even from?\a Pathetic.\a Frogman, let us leave this poor fool alone.
Xeplogi: H-how dare you insult me like that!\a Jess is the most important duchy of Enkress,\a you-
:setSpeaker:Xeplogi||L
:addGenericCharacter:Guard1:
:addGenericCharacter:Guard2:
:play:GuardTheme
:loadUnits:
Guard1: So I came up to him, right, and said:\a you know these statues you like so much?\a Well I- 
Guard2: Silence!\a Ugh, look! You've ruined our ambush!
Xeplogi||L: Oh my! Look at all these monsters and humans!
Firbell||L: Humans?!
Guard1: Oops.
Frogman: Ugh, the Guards again... Let's get out of here.
Firbell||L: You know these humans?!
Frogman||L: Yes. They're-
Guard2: Don't let them get away! Protect the Fortress!
Frogman: All they ever really do is-
Guard1: Hey! I wasn't done with my story!
Frogman: ...I'll explain later. Let's go!
:if:hasCharacter:Xirveros{
:setFlag:XirverosXeplogi1
}
:finishConversation:
}
}
}

~ After battle
:if:furthestLevel:<6{
# PostActualFirst - part of the firstTime convo, never happens
}
:else:{
:if:hasCharacter:Firbell{
# PostPostWin
Frogman: Everyone, this way!\a Let's get out of here!
:loadMap:Part2RestArea
:loadUnits:Part2RestArea
:play:Anticipation
:if:hasCharacter:Xeplogi{
Frogman||L: Ah... Safe at last.
Xeplogi: Indeed. I do believe we could use a moment of rest.
Frogman: ...Nah. Let's just go to the fortress now.\a We've got no time to lose.
Xeplogi: W-well...
Frogman: Are you coming or not?
Xeplogi: Wait!
:hideUnit:Frogman
Ugh...
Firbell: It is just the way that he is.\a You will get used to it,\a Logi.
Xeplogi: And yet, it is so very vexing!\a Why are you following him?
Firbell: ...Do you have a better idea?
Xeplogi: How about you all follow me, instead?\a I assure you, I'm quite the benelovent leader.
Firbell: ...Goodbye,\a duke of nowhere.
:hideUnit:Firbell
Xeplogi: I'm the Duke of Jess, not Nowhere!\a W-wait, don't leave me!\a ...
Ugh, fine...
}
:else:{
Frogman||L: Xeplogi didn't make it, huh?
Firbell: That is good. I did not like him.
Frogman: Because he claimed you aren't a real princess?
Firbell: Yes.
Frogman: ...Okay.\a We're getting pretty close to the fortress.\a Let's just move on.
Firbell: Let us.
:finishConversation:
}
:callOther:Level5GenericXeplogi
:finishConversation:
}

# === Functions ====

~ GuardsArriveFirst
:addGenericCharacter:Guard1:young
:addGenericCharacter:Guard2:old
:play:GuardTheme
???: Hey! Is someone there?
Frogman|: Huh? Another Magmaborn?
Xeplogi||R: I was in the middle-
:loadUnits:
Guard2: No, look! Those are Magmaborn!
Frogman: Humans?!
:if:hasCharacter:Firbell{
Firbell: Humans?!
}
:if:hasCharacter:Kresla{
Kresla: Humans?!
}
:if:hasCharacter:Xirveros{
Xirveros: No... Again... Frog, back...
}
Xeplogi||R: Ugh. The detestable Guards are back.
Frogman: You know these humans?!
Xeplogi: Yes. They are-
Guard1: Aha! This must be my lucky day!\a Fiends! Your reign of terror has come to an end!\a For I, [Name], shall destroy you all!
Xeplogi: All they ever really do is-
Guard2: How many of them are there?!\a Never mind, kill every last one of them!
Xeplogi: They hate-
Guard2: CHAAAAAAAAARGE!
Xeplogi: Oh, shut up! I'm trying to explain-
Frogman: Xeplogi, let's leave the explaining to after this battle.
Xeplogi: You- Ugh, fine.\a Let us do just that, then.
:unlockAchievement:JoinXeplogi
:setFlag:MetXeplogi

~ PreRepeat
:loadUnits::player
Frogman: Structures again? That must mean...
:addUnit:Xeplogi
:loadUnits::player
Xeplogi: Frogman, my dear friend! You're back.
Frogman: Yes.
Xeplogi: It's so good to see you again.\a I wanted to convey my disappointment in you.
Frogman: Likew- Wait, what?
Xeplogi: You died last time we fought together.\a That was a very bad idea.
Frogman: It... wasn't my idea.
Xeplogi: Really? Then we should punish whoever suggested it.\a It was absolutley terrible.
Frogman: Xeplogi, nobody suggested it! I was killed!
Xeplogi: We have a murderer in our ranks?! Who could it be?
:setSpeaker:Xeplogi||L
:addGenericCharacter:Guard1:young
:addGenericCharacter:Guard2:old
:play:GuardTheme
:loadUnits:
Guard1: ...Pfft! Ha ha ha!
Guard2: Silence!\a Ugh, look! You've ruined our ambush!
Xeplogi||L: Oh my! Look at all these monsters and humans!
Frogman: Yes, they're what killed us last time.
We should stop talking if we want to stay alive this time.
Xeplogi: Now, that's a good idea.\a Keep them coming, boy.
Frogman: That- Ugh. Let's just get started.

